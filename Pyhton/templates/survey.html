<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Encuesta</title>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        let currentQuestionIndex = 0;

        function showQuestion(index) {
            document.querySelectorAll('.question').forEach((element, i) => {
                element.style.display = i === index ? 'block' : 'none';
            });
        }

        function nextQuestion() {
            if (validateCurrentQuestion()) {
                if (currentQuestionIndex < document.querySelectorAll('.question').length - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                }
            } else {
                alert('Por favor, responde la pregunta antes de continuar.');
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        }

        function validateCurrentQuestion() {
            const currentQuestion = document.querySelectorAll('.question')[currentQuestionIndex];
            const radios = currentQuestion.querySelectorAll('input[type="radio"]');
            for (let radio of radios) {
                if (radio.checked) {
                    return true;
                }
            }
            return false;
        }

        function validateForm(event) {
            const questions = document.querySelectorAll('.question');
            for (let i = 0; i < questions.length; i++) {
                const radios = questions[i].querySelectorAll('input[type="radio"]');
                let answered = false;
                for (let radio of radios) {
                    if (radio.checked) {
                        answered = true;
                        break;
                    }
                }
                if (!answered) {
                    alert(`Por favor, responde la pregunta ${i + 1}.`);
                    event.preventDefault();
                    showQuestion(i);
                    return false;
                }
            }
            return true;
        }

        document.addEventListener('DOMContentLoaded', () => {
            showQuestion(currentQuestionIndex);
            document.querySelector('form').addEventListener('submit', validateForm);
        });
    </script>
</head>
<body class="bg-gradient-to-r from-blue-900 to-blue-700 text-white">
    <form method="POST" action="/survey" class="max-w-lg mx-auto mt-32">
        {% for pregunta in preguntas %}
            <div class="question bg-white text-black rounded-lg shadow-lg p-6 mb-6" style="display: none;">
                <h2 class="text-xl font-semibold mb-4">{{ pregunta.texto }}</h2>
                {% for opcion in opciones %}
                    <label class="block mb-2">
                        <input type="radio" name="pregunta_{{ pregunta.id }}" value="{{ opcion.id }}" class="mr-2">
                        {{ opcion.texto }}
                    </label>
                {% endfor %}
                
                <div class="flex justify-between mt-4">
                    <button type="button" onclick="prevQuestion()" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Anterior</button>
                    <button type="button" onclick="nextQuestion()" class="bg-blue-700 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">Siguiente</button>
                </div>
            </div>
        {% endfor %}
        
        <input type="submit" value="Enviar" class="mt-4 bg-green-700 hover:bg-green-600 text-white font-bold py-2 px-4 rounded w-full">
    </form>   
    
    <footer class="text-center py-64">
        <p>Â© 2024 TESJi</p>
    </footer>
</body>
</html>
